<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Room Cleaning Checklist</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { AlertCircle, Check, Clock, User, Users } = lucide;

        // Simple in-memory backend simulation with localStorage persistence
        const DB = {
            students: [],
            
            init() {
                const saved = localStorage.getItem('roomChecklistDB');
                if (saved) {
                    this.students = JSON.parse(saved);
                }
            },
            
            save() {
                localStorage.setItem('roomChecklistDB', JSON.stringify(this.students));
            },
            
            addStudent(name) {
                const student = {
                    id: Date.now().toString(),
                    name,
                    items: [
                        { id: 'bedroller', name: 'Bedroller', status: 'pending' },
                        { id: 'matress', name: 'Matress', status: 'pending' },
                        { id: 'shelf', name: 'Shelf', status: 'pending' },
                        { id: 'cupboard', name: 'Cupboard', status: 'pending' }
                    ]
                };
                this.students.push(student);
                this.save();
                return student;
            },
            
            getStudent(id) {
                return this.students.find(s => s.id === id);
            },
            
            getAllStudents() {
                return this.students;
            },
            
            updateItemStatus(studentId, itemId, status) {
                const student = this.getStudent(studentId);
                if (student) {
                    const item = student.items.find(i => i.id === itemId);
                    if (item) {
                        item.status = status;
                        this.save();
                        return true;
                    }
                }
                return false;
            },
            
            deleteStudent(studentId) {
                this.students = this.students.filter(s => s.id !== studentId);
                this.save();
            },
            
            clearAll() {
                this.students = [];
                this.save();
            }
        };

        // Initialize DB
        DB.init();

        const Icon = ({ icon: IconComponent, ...props }) => {
            return <IconComponent {...props} />;
        };

        const TeacherView = () => {
            const [students, setStudents] = useState(DB.getAllStudents());
            const [newStudentName, setNewStudentName] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);

            const refresh = () => setStudents([...DB.getAllStudents()]);

            const addStudent = () => {
                if (newStudentName.trim() && students.length < 20) {
                    DB.addStudent(newStudentName.trim());
                    setNewStudentName('');
                    setShowAddForm(false);
                    refresh();
                }
            };

            const markAsDone = (studentId, itemId) => {
                DB.updateItemStatus(studentId, itemId, 'done');
                refresh();
            };

            const deleteStudent = (studentId) => {
                if (confirm('Are you sure you want to remove this student?')) {
                    DB.deleteStudent(studentId);
                    refresh();
                }
            };

            const getStudentLink = (studentId) => {
                return `${window.location.origin}${window.location.pathname}?student=${studentId}`;
            };

            const copyLink = (studentId) => {
                const link = getStudentLink(studentId);
                navigator.clipboard.writeText(link);
                alert('Link copied to clipboard!');
            };

            const getProgress = (student) => {
                const done = student.items.filter(i => i.status === 'done').length;
                return `${done}/4`;
            };

            const getStatusColor = (status) => {
                if (status === 'done') return 'bg-green-500';
                if (status === 'ready') return 'bg-yellow-500';
                return 'bg-gray-300';
            };

            return (
                <div className="min-h-screen bg-red-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-6">
                                <div className="flex items-center gap-3">
                                    <Icon icon={Users} className="text-red-600" size={32} />
                                    <h1 className="text-2xl font-bold text-gray-800">Christmas Room Cleaning</h1>
                                </div>
                                <span className="text-sm text-gray-600">Teacher View</span>
                            </div>

                            {students.length < 20 && (
                                <div className="mb-6">
                                    {!showAddForm ? (
                                        <button
                                            onClick={() => setShowAddForm(true)}
                                            className="w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 transition"
                                        >
                                            + Add Student
                                        </button>
                                    ) : (
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={newStudentName}
                                                onChange={(e) => setNewStudentName(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && addStudent()}
                                                placeholder="Student name"
                                                className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                                                autoFocus
                                            />
                                            <button
                                                onClick={addStudent}
                                                className="bg-green-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-green-700 transition"
                                            >
                                                Add
                                            </button>
                                            <button
                                                onClick={() => setShowAddForm(false)}
                                                className="bg-gray-300 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-400 transition"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {students.length === 0 ? (
                                <div className="text-center py-12 text-gray-500">
                                    <Icon icon={Users} size={48} className="mx-auto mb-4 opacity-50" />
                                    <p>No students added yet. Add your first student to get started!</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {students.map((student) => (
                                        <div key={student.id} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                            <div className="flex items-center justify-between mb-3">
                                                <div className="flex items-center gap-2">
                                                    <Icon icon={User} size={20} className="text-gray-600" />
                                                    <h3 className="font-semibold text-lg">{student.name}</h3>
                                                    <span className="text-sm text-gray-600">({getProgress(student)})</span>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => copyLink(student.id)}
                                                        className="text-sm bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition"
                                                    >
                                                        Copy Link
                                                    </button>
                                                    <button
                                                        onClick={() => deleteStudent(student.id)}
                                                        className="text-sm bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                            </div>

                                            <div className="grid grid-cols-2 gap-3">
                                                {student.items.map((item) => (
                                                    <div key={item.id} className="bg-white p-3 rounded border border-gray-200">
                                                        <div className="flex items-center justify-between mb-2">
                                                            <span className="font-medium text-sm">{item.name}</span>
                                                            <div className={`w-3 h-3 rounded-full ${getStatusColor(item.status)}`} />
                                                        </div>
                                                        
                                                        {item.status === 'pending' && (
                                                            <span className="text-xs text-gray-500">Waiting...</span>
                                                        )}
                                                        
                                                        {item.status === 'ready' && (
                                                            <button
                                                                onClick={() => markAsDone(student.id, item.id)}
                                                                className="w-full bg-green-600 text-white py-2 rounded text-sm font-medium hover:bg-green-700 transition flex items-center justify-center gap-1"
                                                            >
                                                                <Icon icon={Check} size={16} />
                                                                Mark Done
                                                            </button>
                                                        )}
                                                        
                                                        {item.status === 'done' && (
                                                            <div className="flex items-center gap-1 text-green-600 text-sm">
                                                                <Icon icon={Check} size={16} />
                                                                <span>Completed</span>
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="text-center text-sm text-gray-600">
                            <p>Students: {students.length}/20</p>
                        </div>
                    </div>
                </div>
            );
        };

        const StudentView = ({ studentId }) => {
            const [student, setStudent] = useState(null);

            const refresh = () => {
                const s = DB.getStudent(studentId);
                setStudent(s ? { ...s } : null);
            };

            useEffect(() => {
                refresh();
                const interval = setInterval(refresh, 2000);
                return () => clearInterval(interval);
            }, [studentId]);

            const markAsReady = (itemId) => {
                DB.updateItemStatus(studentId, itemId, 'ready');
                refresh();
            };

            if (!student) {
                return (
                    <div className="min-h-screen bg-red-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-lg p-8 text-center">
                            <Icon icon={AlertCircle} className="mx-auto mb-4 text-red-500" size={48} />
                            <h2 className="text-xl font-bold mb-2">Student Not Found</h2>
                            <p className="text-gray-600">Please check your link and try again.</p>
                        </div>
                    </div>
                );
            }

            const getProgress = () => {
                return student.items.filter(i => i.status === 'done').length;
            };

            return (
                <div className="min-h-screen bg-red-50 p-4">
                    <div className="max-w-md mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="text-center mb-6">
                                <h1 className="text-2xl font-bold text-gray-800 mb-2">Christmas Room Cleaning</h1>
                                <div className="flex items-center justify-center gap-2 text-lg">
                                    <Icon icon={User} className="text-red-600" size={24} />
                                    <span className="font-semibold">{student.name}</span>
                                </div>
                                <div className="mt-4 bg-red-100 rounded-full h-3 overflow-hidden">
                                    <div 
                                        className="bg-red-600 h-full transition-all duration-500"
                                        style={{ width: `${(getProgress() / 4) * 100}%` }}
                                    />
                                </div>
                                <p className="text-sm text-gray-600 mt-2">{getProgress()} of 4 completed</p>
                            </div>

                            <div className="space-y-3">
                                {student.items.map((item) => (
                                    <div key={item.id} className="border border-gray-200 rounded-lg p-4 bg-gray-50">
                                        <div className="flex items-center justify-between mb-3">
                                            <h3 className="font-semibold text-lg">{item.name}</h3>
                                            {item.status === 'done' && <Icon icon={Check} className="text-green-600" size={24} />}
                                            {item.status === 'ready' && <Icon icon={Clock} className="text-yellow-600" size={24} />}
                                        </div>

                                        {item.status === 'pending' && (
                                            <button
                                                onClick={() => markAsReady(item.id)}
                                                className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition"
                                            >
                                                I'm Ready for Check
                                            </button>
                                        )}

                                        {item.status === 'ready' && (
                                            <div className="bg-yellow-100 border border-yellow-300 rounded-lg p-3 text-center">
                                                <Icon icon={Clock} className="mx-auto mb-2 text-yellow-700" size={24} />
                                                <p className="text-sm text-yellow-800 font-medium">Waiting for teacher to check</p>
                                            </div>
                                        )}

                                        {item.status === 'done' && (
                                            <div className="bg-green-100 border border-green-300 rounded-lg p-3 text-center">
                                                <Icon icon={Check} className="mx-auto mb-2 text-green-700" size={24} />
                                                <p className="text-sm text-green-800 font-medium">Completed! Well done!</p>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                        {getProgress() === 4 && (
                            <div className="bg-green-600 text-white rounded-lg shadow-lg p-6 text-center">
                                <div className="text-4xl mb-2">ðŸŽ„</div>
                                <h2 className="text-xl font-bold mb-2">All Done!</h2>
                                <p>Your room is ready for Christmas! Great job!</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        function RoomChecklistApp() {
            const [view, setView] = useState('teacher');
            const [studentId, setStudentId] = useState(null);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const student = params.get('student');
                if (student) {
                    setStudentId(student);
                    setView('student');
                }
            }, []);

            return view === 'teacher' ? <TeacherView /> : <StudentView studentId={studentId} />;
        }

        ReactDOM.render(<RoomChecklistApp />, document.getElementById('root'));
    </script>
</body>
</html>